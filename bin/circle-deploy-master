#!/bin/bash

set -e

source "$STATE"

if [ -z "$SKIP_TESTS" ] ; then
    docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
    cd $SRCDIR
    make clean-bin
    make publish
fi

go get github.com/weaveworks/wordepress
cd /home/ubuntu/src/github.com/weaveworks/wordepress
git checkout v1.0.0
cd cmd/wordepress
go get

cd $SRCDIR
bin/publish-site "$WP_DEV_URL" "$WP_DEV_USER" "$WP_DEV_PASSWORD"
